### **数字电子技术基础 – 计数器和寄存器**

### **1. 课程目标**

本讲座旨在：
*   简要回顾状态机（State Machines）的概念。
*   介绍计数器，包括同步（synchronous）和异步（asynchronous）两种类型。

---

### **2. 有限状态机（Finite State Machine - FSM）概念**

*   **定义：** 有限状态机是一种电路，它会根据系统的当前状态以及（在多数情况下）一组输入条件，在时钟脉冲的驱动下产生状态变化。
*   **计数器作为FSM示例：**
    *   **无外部输入：** 简单的计数器没有数据输入，其状态转换仅由时钟脉冲触发。
    *   **时钟驱动转换：** 状态的改变是对时钟脉冲的响应。
    *   **循环性：** 计数器会按照预定的顺序循环经过一系列状态。

*   **3位计数器的状态表示例：**

| 当前状态 (A₂, A₁, A₀) | 下一状态 (Y₂, Y₁, Y₀) |
| :------------------ | :----------------- |
| 000                 | 001                |
| 001                 | 010                |
| 010                 | 011                |
| 011                 | 100                |
| 100                 | 101                |
| 101                 | 110                |
| 110                 | 111                |
| 111                 | 000                |

---

### **3. 3位计数器设计**

*   **设计原理：** 计数器的下一状态 (Y₂, Y₁, Y₀) 是当前状态 (A₂, A₁, A₀) 的函数。这意味着我们需要设计一个组合逻辑电路（Logic Gates），根据当前状态生成下一状态所需的输入信号。
*   **逻辑表达式：** 通过分析状态转换表，可以推导出每个输出位的布尔表达式：
    *   **Y₀ = A̅₀** (最低有效位总是翻转)
    *   **Y₁ = A₁ ⊕ A₀** (异或门)
    *   **Y₂ = A₂A̅₁ + A₂A̅₀ + A̅₂A₁A₀**

*   **电路实现：** 使用D型触发器（D-type's）和组合逻辑门（如与门、或门、异或门）可以构建一个FSM 3位计数器。每个时钟脉冲到来时，逻辑门的输出（Y₂, Y₁, Y₀）被加载到触发器中，成为新的当前状态（A₂, A₁, A₀）。

---

### **4. 计数器类型**

*   **异步计数器 (Asynchronous Counter):**
    *   也称为**纹波计数器 (Ripple Counter)**。
    *   内部的触发器**不共享**一个共同的时钟信号。
    *   前一个触发器的输出通常用作后一个触发器的时钟输入。
    *   因此，状态变化不是同时发生的，而是像波纹一样逐级传递。
    *   **缺点：** 存在**传播延迟 (Propagation Delay)**。由于信号需要逐级传递，从输入时钟变化到最终输出稳定需要一段时间，这个延迟随触发器数量的增加而累积。

*   **同步计数器 (Synchronous Counter):**
    *   所有的触发器都连接到**同一个**时钟信号。
    *   所有触发器的状态变化在时钟脉冲的同一有效边沿**同时发生**。
    *   **优点：** 解决了异步计数器的传播延迟问题，速度更快，性能更稳定。

*   **模 (Modulus):**
    *   计数器的模是指其能够计数的**唯一状态的数量**。
    *   对于一个包含 `n` 个触发器的计数器，其最大可能的状态数是 **2ⁿ**。

> **注：** 虽然可以使用状态机和D型触发器构建计数器，但使用**J-K触发器**的**翻转模式 (toggle mode)** 可以简化逻辑设计。

---

### **5. 异步计数器详解**

*   **2位异步二进制计数器：**
    *   使用两个J-K触发器（FF0和FF1）。
    *   时钟脉冲（CLK）仅输入到第一个触发器（FF0）。
    *   FF0的输出Q₀连接到FF1的时钟输入端。
    *   所有J和K输入都接高电平（HIGH），使触发器处于翻转模式。
    *   **工作原理：** Q₀的频率是CLK频率的一半，Q₁的频率是Q₀频率的一半。实现了频率分频。

*   **3位异步二进制计数器：**
    *   与2位类似，但级联了第三个触发器（FF2）。
    *   Q₁连接到FF2的时钟输入端。
    *   实现了从000到111的计数，然后循环回000。

---

### **6. 同步计数器详解**

*   **2位同步二进制计数器：**
    *   时钟脉冲（CLK）同时连接到所有触发器（FF0和FF1）的时钟输入端。
    *   FF0的输出Q₀连接到FF1的J和K输入端。
    *   **工作原理：**
        *   FF0在每个时钟脉冲翻转。
        *   FF1仅在Q₀为高电平时翻转。
    *   状态变化是同时的，延迟相同。

*   **3位同步二进制计数器：**
    *   CLK同样连接到所有触发器。
    *   FF2的J和K输入由一个与门（AND gate）驱动，该与门的输入是Q₀和Q₁。
    *   **工作原理：** FF2仅在Q₀和Q₁同时为高电平时翻转。

---

### **7. 计数器的通用逻辑组件**

计数器通常被集成为具有以下控制引脚的逻辑组件：

*   **cnt (count enable):** 同步使能端，用于启动或暂停计数。
*   **ld (load):** 同步并行加载端，用于将一个特定的值 **L** 初始化到计数器。
*   **clr (clear):** 同步清零端，用于将计数器重置为零。
*   **tc (terminal count):** 终端计数输出。当计数器达到其最终状态时，该引脚会产生一个信号。
*   **C:** 计数器的并行输出。

---

### **8. 计数器的常见应用**

#### **A. 创建特定倍数时钟的脉冲（频率分频）**

*   **目标：** 生成一个周期是主时钟周期整数倍的脉冲信号。
*   **示例：生成9分频脉冲**
    *   **使用4位递减计数器：**
        1.  将并行加载输入 **L** 设置为 `9-1=8`（二进制`1000`）。
        2.  将终端计数输出 **tc** 连接到加载端 **ld**。
        3.  当计数器从8减到0时，**tc** 产生一个脉冲。这个脉冲会触发 **ld**，在下一个时钟周期将计数器重新加载为8。
        4.  这样，每9个时钟周期，**tc** 就会输出一个脉冲。
    *   **使用4位递增计数器：**
        1.  需要将计数器设置为在计到特定值时复位。例如，要计数9个周期，可以检测计数值`8`（二进制`1000`），然后通过逻辑门清零或重新加载。

#### **B. 时钟分频（除以2的幂）**

*   **目标：** 将时钟频率除以一个2的N次幂的值。
*   **示例：将512Hz转换为2Hz**
    1.  需要的分频系数是 `512 / 2 = 256`。
    2.  由于 `256 = 2⁸`，需要一个 **8位计数器**。
    3.  让8位计数器自由运行，从0计数到255。
    4.  当计数器从255变为0时，其**终端计数（tc）**会产生一个脉冲。
    5.  这个脉冲的频率就是 `512Hz / 256 = 2Hz`。

#### **C. 时钟分频（除以非2的幂）**

*   **目标：** 将时钟频率除以任意整数。
*   **示例：将60Hz转换为1Hz**
    1.  需要的分频系数是60。
    2.  需要一个能计数到至少59的计数器，即 `2ⁿ >= 60`，所以 `n=6`（6位计数器，最大计数值63）。
    3.  使用一个 **6位递增计数器**。
    4.  使用组合逻辑检测计数器输出何时达到 `60-1=59`（二进制`111011`）。
    5.  当检测到59时，通过逻辑电路在下一个时钟脉冲的上升沿将计数器**清零（clr）**。
    6.  这样，计数器每60个周期产生一个脉冲，实现了1Hz的信号。

#### **D. 作为计时器（测量事件之间的时间）**

*   **目标：** 测量两个事件之间经过的时间。
*   **示例：测量汽车通过a、b两点的速度**
    1.  使用两个传感器a和b。
    2.  当汽车通过传感器a时，启动计数器（`cnt=1`），计数器开始以已知的时钟频率（如1kHz）计数。
    3.  当汽车通过传感器b时，停止计数器（`cnt=0`）。
    4.  读取计数器的最终计数值 **C**。
    5.  **时间 = C × 时钟周期**。例如，如果时钟是1kHz（周期1ms），则时间 = C × 0.001秒。
    6.  **速度 = 距离d / 时间**。

---

### **9. 总结**

*   介绍了计数器作为一种重要的**时序逻辑组件**。
*   学习了**同步计数器**和**异步计数器**的内部设计原理和区别。
*   探讨了如何根据具体应用（如频率分频、计时）来配置和使用计数器。